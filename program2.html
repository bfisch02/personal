<!DOCTYPE html>
<html>


<head>
<link rel="stylesheet" href="program.css">
<link href="program.js">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

<script>
doneClicked=false;
$(document).ready(function(){
	$("#yesButton").click(function(){
  		$(this).hide();
   		start();
    	})
    });	

function start()
{
	$("#NAO").hide();
   	$('#scrollBox').css('visibility','visible');
   	$('#timelineLabel').css('visibility','visible');
   	$('#bottom').css('visibility', 'visible');
   	$('#corner').css('visibility', 'visible');
   	$('#bottomScreen').css('visibility', 'visible');
   	$("#standing").css('visibility','visible');
   	$("#sitting").css('visibility','hidden');
   	$("#finish").css('visibility','visible');
   	$("#finish2").css('visibility','visible');
   	$("#finish2").hide();
   	$("#xButton").css('visibility','visible');
   	$("#xButton").hide();
   	$("#xButton2").css('visibility','visible');
   	$("#xButton2").hide();
	numCanvases=0;
	currCanvas = 0;
	img = new Image();
    img.src = 'NAOcanvas7.jpg';
    actions = new Array;
    text = new Array;
    durations = new Array;
    standing = new Array;
    standing[0] = true;
    $("#nextButton").click(function(){doneClick();});
   /* $("#finish").mouseover(function(){
    	$("#finish2").show();
    	$("#finish2").mouseout(function() {
    		$("#finish2").hide();
    	});
    	$("#finish2").click(function(){sendInfo();});
    });*/
    $("#finish").click(function(){sendInfo();});
	inventCanvas();
}

function inventCanvas()
{
	numCanvases+=1;
	if(numCanvases!=1) {
		currCanvas +=1;
		if ((standing[currCanvas-1] && actions[currCanvas-1]!="Sit Down") || actions[currCanvas-1]=="Stand Up")
			standing[currCanvas]=true;
		else
			standing[currCanvas]=false;
		
		if (standing[currCanvas]) {
   			standingOptions();
   		}
   		else {
   			sittingOptions();
   		}
	}
	$("#nextButton").show();
	$('body').append('<canvas id="myCanvas' + (numCanvases-1) + '" class="canvasClass" height="450" width="780"></canvas>')
	$(document.getElementById("myCanvas"+(numCanvases-1))).css({height:"450px",marginLeft:"+=205px"});
	canvas = document.getElementById("myCanvas" + (numCanvases-1));
	if (canvas.getContext) {
  		ctx = canvas.getContext('2d');
		ctx.save();
		initializeCanvas();
	}
 	if (numCanvases!=0 && numCanvases != (currCanvas+1)) {
 		$(document.getElementById("myCanvas"+(numCanvases-1))).hide();
 		$(document.getElementById("myCanvas"+(currCanvas))).show();
		inventMidCanvas();
	}
}

function inventMidCanvas()
{		
	for (i=numCanvases;i>currCanvas;i--) {
		actions[i] = actions[i-1];
		text[i]= text[i-1];
		standing[i] = standing[i-1];
		if (document.getElementById("duration"))
			durations[i] = durations[i-1];
		$("#timelinetext"+i).html(
			actions[i]+'</br> Say: "'+text[i]+'"</p>');
		$("#timeline"+(currCanvas)).css('border','5px red inset');
	}
	actions[currCanvas] = "No Action";
	text[currCanvas] = "";
	durations[currCanvas] = "";
	$("#timelinetext"+currCanvas).html("");
	$("#timeline"+currCanvas).hide();
	$("#timeline"+currCanvas).slideDown(200);
}

function initializeCanvas()
{
	ctx.drawImage(img, 0, 0);
    $("#nextButton").css('visibility', 'visible');
    $("#canvasAction").css('visibility', 'visible');
    $("#canvasText").css('visibility', 'visible');
    ctx.fillStyle="rgb(0, 210, 240)";
    if (numCanvases < 10) {
   		ctx.font = "bold 100px arial";
   		ctx.fillText(numCanvases, 4, 90);
   	}
    else {
   		ctx.font = "bold 70px arial";
   		ctx.fillText(numCanvases, 3, 70);
   	}
   	getInfo();
   	addTimelineElement();
}

function addTimelineElement()
{
   	$("#scrollBox").append('<div id="timeline'+(numCanvases-1)+'" name = '+(numCanvases-1)+' class="timelineElement"><p><strong>Part '+numCanvases+'</strong><p><div id="timelinetext'+(numCanvases-1)+'"></div></div>');
   	$("#timeline"+currCanvas).hide();
	$("#timeline"+currCanvas).slideDown(200);
   	if (numCanvases==(currCanvas+1))
   		$("#timeline"+(numCanvases-1)).css('border','5px inset rgb(255, 0, 0)');
   	else
   		$("#timeline"+(numCanvases-1)).css('border','5px outset');
   	$("#timeline"+(numCanvases-1)).mouseover(function(){
   		if ($(this).css('border')!='5px inset rgb(255, 0, 0)')
   			$(this).css('border','5px inset');
   		else {
   			$("#xButton").show();
   			$("#xButton").css("top",(20+(currCanvas*140))+"px");
   			$("#xButton").mouseover(function(){
   				deleting=true;
   				$("#xButton2").show();
   				$("#xButton2").css("top",(17+(currCanvas*140))+"px");
   				$("#xButton2").click(function(){
   					deleteCanvas();
   					deleting=false;
   				});
   				$("#xButton2").mouseout(function(){
   					$("#xButton2").hide();
   				});
   			});
   		}
   	});
   	$("#timeline"+(numCanvases-1)).mouseout(function(){
   		if ($(this).css('border')!='5px inset rgb(255, 0, 0)')
   			$(this).css('border','5px #e2e2e2 outset');
   		else
   			$("#xButton").hide();
   	});
   	$("#timeline"+(numCanvases-1)).click(function(){
   		$("#timeline"+(currCanvas)).css('border','5px #e2e2e2 outset');
   		$(this).css('border','5px red inset');
   		if (!this.id[9]) {
   			thisCanvas=this.id[8];
   		}
   		else {
   			thisCanvas=(this.id[8]+this.id[9]);
   		}
   		if (currCanvas!=thisCanvas)
   			editCanvas();
   	});

}

function standingOptions()
{
	if (document.getElementById("stand")){
		$("#select option[id='stand']").remove();
		$("#select option[id='lie']").remove();
		$("#select option[id='stand']").remove();
		$("#select").append('<option id="sit" value="Sit Down">Sit Down</option>');
		$("#select").append('<option id="walkF" value = "Walk Forward">Walk Forward</option>');
		$("#select").append('<option id="walkB" value = "Walk Backward">Walk Backward</option>');
		$("#sitting").css('visibility','hidden');
   		$("#standing").css('visibility','visible');
	}
}

function sittingOptions()
{
	if (document.getElementById("sit")){
		$("#select option[id='sit']").remove();
		$("#select option[id='walkF']").remove();
		$("#select option[id='walkB']").remove();
		$("#select").append('<option id="stand" value = "Stand Up">Stand Up</option>');
		$("#select").append('<option id="lie" value = "Lie Down">Lie Down</option>');
		$("#sitting").css('visibility','visible');
   		$("#standing").css('visibility','hidden');
   		
	}
}

function editCanvas()
{
	
	if(!text[currCanvas] || text[currCanvas] == "")
		getInfo();
	$(document.getElementById("myCanvas"+currCanvas)).hide();
	currCanvas = parseInt(thisCanvas);
	if (standing[currCanvas]) {
		$("#sitting").css('visibility','hidden');
		$("#standing").css('visibility','visible');
		standingOptions();
	}
   	else {
   		$("#sitting").css('visibility','visible');
   		$("#standing").css('visibility','hidden');
   		sittingOptions();
   	}
	$(document.getElementById("myCanvas"+currCanvas)).show();
	document.getElementById("textarea").value = text[currCanvas];
	document.getElementById("select").value = actions[currCanvas];
	if (true)
		$(document.getElementById("duration")).css('visibility','hidden');
}

function deleteCanvas()
{
	if (deleting) {
		if (numCanvases==1)
			alert("You can't delete the only part to the story!");
		else if (actions[currCanvas] == "Stand Up" || actions[currCanvas] == "Sit Down")
			alert("You can't delete this part without adding a new part or deleting Part " + (currCanvas+1));
		else {
			alert("This will do something soon...");
			/*numCanvases--;
			for (i=currCanvas;i<numCanvases;i++) {
				actions[i] = actions[i+1];
				text[i]= text[i+1];
				standing[i] = standing[i+1];
				if (document.getElementById("duration"))
					durations[i] = durations[i+1];
				$("#timelinetext"+i).html(
					actions[i]+'</br> Say: "'+text[i]+'"</p>');
				$("#timeline"+(currCanvas)).css('border','5px red inset');
			}
			$("#timeline"+currCanvas).slideUp(200);*/
		}
		deleting=false;
	}
}

function doneClick()
{
	doneClicked = true;
	if ((document.getElementById("select").value != "No Action")||(document.getElementById("textarea").value != "") || currCanvas!=numCanvases-1) {
		$("#nextButton").hide();
		$("#timeline"+currCanvas).css('border','5px #e2e2e2 outset');
		getInfo();
		document.getElementById("noAction").selected = true;
		document.getElementById("textarea").value = "";
		$(document.getElementById("duration")).css('visibility','hidden');
    	if (currCanvas ==0) {
			$(document.getElementById("myCanvas"+currCanvas)).slideUp();
			img = new Image();
    		img.src = 'NAOcanvas2.jpg';
    	}
		else
			$(document.getElementById("myCanvas"+currCanvas)).slideUp();
   		inventCanvas();
   	}
   	doneClicked=false;
   	
}

function getInfo()
{
	if (!doneClicked) {
	actions[currCanvas] = document.getElementById("select").value;
	text[currCanvas]= document.getElementById("textarea").value;
	if (document.getElementById("duration"))
		durations[currCanvas] = document.getElementById("duration").value;
	$("#timelinetext"+currCanvas).html(
	actions[currCanvas]+'</br> Say: "'+text[currCanvas]+'"</p>');
}
}

function addSelect()
{
	/*if (document.getElementById("select").value == "Walk Forward" || document.getElementById("select").value == "Walk Backward") {
		$("#canvasAction2").html(
			'<select id = "duration"><option id="5">For five seconds</option><option id="10">For ten seconds</option><option id="15">For fifteen seconds</option><option id="20">For twenty seconds</option></select>');
	}
	else {
		$(document.getElementById("duration")).css('visibility','hidden');
	}
	*/
	if (document.getElementById("select").value == "Sit Down" || (document.getElementById("select").value != "Stand Up" && !document.getElementById("sit"))) {
		if (currCanvas!=numCanvases-1 && standing[currCanvas+1]) {
			if (confirm('I am standing up in Part ' + (currCanvas+2) + '. If you press "Continue", I will add a new part to the story so that I can stand up.')) {
				getInfo();
				fixError();
			}
			else 
				document.getElementById("select").value = actions[currCanvas];
		}
		else
			getInfo();
   	}
   	else if (document.getElementById("select").value == "Stand Up" || (document.getElementById("select").value != "Sit Down" && !document.getElementById("stand"))) {
		if (currCanvas!=numCanvases-1 && !standing[currCanvas+1]) {
			if (confirm('I am sitting down in Part ' + (currCanvas+2) + '. If you press "Continue", I will add a new part to the story so that I can sit down.')) {
				getInfo();
				fixError();
			}
			else
				document.getElementById("select").value = actions[currCanvas];
		}
		else
			getInfo();
	}
	else
		getInfo();
}

function fixError()
{
	doneClick();
	if (standing[currCanvas+1]) {
		document.getElementById("sit").selected = true;
		getInfo();
		standing[currCanvas+1]=false;
	}
	else {
		document.getElementById("stand").selected = true;
		getInfo();
		standing[currCanvas+1]=true;
	}	
}

function sendInfo()
{
	if (confirm("Are you sure the story is over?")) {
		alert("sending");
		for(i = 0; i<numCanvases; i++) {
			alert("Action: " + actions[i] + " Speech: " + text[i]);
		}
		try {
			request = new XMLHttpRequest();
			request2 = new XMLHttpRequest();
		}
		catch(ex) {
			alert("oops");
		}
	}
	/*for (i=0; i<1; i++) {
	request2.open("GET", "http://130.64.94.118:3239/"+actions[i],true);
	request2.send(null);
	request.open("GET", "http://130.64.94.118:3239/say%20" + text[i],true);
	request.send(null);
	
	}
	request2.open("GET",'nao.local:9559/?eval=ALBehaviorManager.runBehavior("Stand%20Up")',true);
	
	
	alert("done");*/
// this is the story that I want to tell you about me standing up.
}


function delay(time) {
  var d1 = new Date();
  var d2 = new Date();
  while (d2.valueOf() < d1.valueOf() + time) {
    d2 = new Date();
  }
}

</script>
</head>
<body>
<img id="NAO" src="NAO_image2.jpg">
<img id="yesButton" src="YesButton2.jpg">


<p id="test"></p>
<div id="canvasAction" ><select id = "select" onchange="addSelect()"><option id="noAction" value="No Action">No Action</option><option id="wave" value = "Wave">Wave</option><option id="sit" value="Sit Down">Sit Down</option><option id="walkF" value = "Walk Forward">Walk Forward</option><option id="walkB" value = "Walk Backward">Walk Backward</option></select></div>
<div id="canvasAction2" ></div>
<div id="canvasText" ><textarea id = "textarea" rows="13" cols="19" onchange="getInfo()"></textarea></div>
<div id="bottomScreen"></div>
<div id="timelineLabel"><h1> TIMELINE </h1></div>
<div id="scrollBox"><img id="xButton" src="xButton.jpg"><img id="xButton2" src="xButton2.jpg"></div>
<div id="bottom"></div>
<div id="corner"></div>

<img id="nextButton" src="addNextPart2.jpg">
<img id="sitting" src="naoSitting2.jpg">
<img id="standing" src="naoStanding.jpg">
<img id="finish" src="finishStory.jpg">
<img id="finish2" src="finishButton2.jpg">

</body>
</html>


